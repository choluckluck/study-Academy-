<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>금액계산하기</title>

<style type="text/css">
	
	table, th, td {border: solid 1px gray;}
	
	table {border-collapse: collapse; 
	       width: 50%;}
	
	td {text-align: center;}
	
	input {
		margin-left: 20px;
	}
</style>

</head>
<body>

<div>
	<h2>계산서</h2>
	<table id="tbl">
		<thead>
			<tr>
				<th width="25%">제품명</th>
				<th width="50%">단가 및 수량</th>
				<th width="25%">금액</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>사과</td>
				<td>1,000<input type="number" min="0" max="10" value="0" id="apple" /></td><td id="apple">0</td>
			</tr>
			<tr>
				<td>딸기</td>	
				<td>2,000<input type="number" min="0" max="10" value="0" id="strawberry" /></td><td id="strawberry">0</td> 
			</tr>
			<tr>
				<td>참외</td>	
				<td>3,000<input type="number" min="0" max="10" value="0" id="melon" /></td>
				<td id="melon">0</td>
			</tr>
		</tbody>
		<tfoot>
			<tr>
				<td colspan="2">총액</td>
				<td>0</td>
			</tr>
		</tfoot>
	</table>
</div>

<div id="display_error">
	<span style="color: red;">수량은 0개 이상 10개 이하 이어야 합니다.</span>
</div>

<script type="text/javascript">
 
   const display_error = document.querySelector("div#display_error");
   display_error.style.display = "none";
   
   
   const tbl = document.querySelector('table#tbl');
   
// tbl.onchange = function(){};
// 또는  
// tbl.onchange = ()=>{};
// 또는  
   tbl.addEventListener('change', function(e){
	   
	   // alert(e.target.id);      // apple   strawberry    melon
	   // alert(e.target.value);   // 0 1 2
	   // alert(e.target.parentNode.innerText); // 1,000   2,000   3,000
	   
   /* 
       노드.parentNode.parentNode - 부모노드 의 부모노드
       노드.parentNode      - 부모노드
       노드.childNodes      - 모든자식노드들
       노드.firstChild      - 첫째자식노드
       노드.lastChild       - 막내자식노드
       노드.nextSibling     - 나의바로밑동생노드(형제노드)
       노드.previousSibling - 나의바로위형노드(형제노드)
       
       !! 조심할 사항은 태그사이에 띄어쓰기를 하거나 태그를 줄 바꿈을 해버리면
          띄어쓰기나 줄바꿈을 텍스트 노드(text node)로 취급해버리므로 
          원하는 노드의 값을 가지고 오지 않고 undefined 가 나온다.  
          
       이렇게 undefined 가 나오지 않도록 하기 위해서 우리는 노드에 id 값을 주어서 처리하도록 한다.     
    */
	
	   let price = e.target.parentNode.innerText;  // "1,000"  "2,000"  "3,000"
	   price = Number(price.split(",").join(""));  // ["1","000"] --> "1000" --> 1000
	                                               // 1000   2000   3000
    // alert(price);  // 1000   2000   3000
	// alert(typeof(price)); // number
	  
	   let su = Number(e.target.value);
	
	   price *= su; // price = price * su;
	   
	// alert(price);
	
	// alert(e.target.parentNode.nextSibling.innerHTML);
	//    사과는 0 나오고 딸기도 0 나온다. 하지만 참외만 undefined 가 나온다.
	
	   const id = e.target.id;
	   const elemnt = document.querySelector(`td#${id}`);
	// alert(elemnt.innerHTML);
	   elemnt.innerHTML = price.toLocaleString("en");
	   
	   const elemnt_list = document.querySelectorAll("table#tbl > tbody > tr > td:last-child"); 
	   const elemnt_arr = Array.from(elemnt_list, item => Number( item.innerText.split(",").join("") ));
  //   console.log(elemnt_arr);
	   // (3) [1000, 4000, 9000]
	   
	   let sum = 0;
	   for(let item of elemnt_arr) {
		   sum += item;
	   }// end of for------------------
	   
  //   console.log(sum);
	   //  14000
	   
	   document.querySelector("table#tbl > tfoot > tr > td:last-child").innerHTML = sum.toLocaleString('en');
	   
   });
   
   //////////////////////////////////////////////////////////////////////////////////////////////
   

   
   //tbl.addEventListener('keydown',function(e){});
   // 또는
   // tbl.onkeydown = function(e){};
   // 또는
   // tbl.onkeydown = e=>{};
   // 또는
   // tbl.tbl.onkeydown = function(e){
   //   alert("키보드를 눌럿다가...?")
   // };
   
   
      //tbl.addEventListener('keyup',function(e){});
   // 또는
   // tbl.onkeyup = function(e){};
   // 또는
   //tbl.onkeyup = e=>{};
   // 또는
   tbl.onkeyup = function(e){
	   // alert("키보드를 눌럿다가...?")
	   func_calcurate(e.target);
	   // 이벤트가 발생되어진 엘리먼트...?
   };
   
   function func_calcurate() {
	   alert("func_calcurate() 함수작동합니다~~");
	   
	   let price = target.parentNode.innerText;
	   price = Number(price.split(",").join(""));
   
   	   let su = Number(target.value);
   	   
   	   if(su < 0 || su > 10) {
   		   	alert("수량은 0개 이상 10개 이하이어야 합니다!!");
   	   		
   		   	su = 0;
   		   	target.value = "0";
   		 	document.querySelector(`td#${target.id}`).innerHTML = "0";
   		   	return;
   	   }
   	   else {
   		   display_error.style.display = "none";
   		   
   		   price *= su;
   		   
   		   document.querySelector(`td#${target.id}`).innerHTML = price.toLocaleString('en');
   		   
   		   const element_list = document.querySelectorAll("table#tbl > tbody > tr > td:last-child");
   		   const element_arr = Array.from(element_list, item => Number(item.innerText.split(",").join("")));
   		   
   		   let sum = 0;
   		   for(let item of elemt_arr) {
   			   sum += item;
   		   } // end of for
   	   	
   		   document.querySelector("table#tbl > tfoot > tr > td:last-child")
   	   }
   	   
   	   alert("헤헤헤");
   };
   
</script>

</body>
</html>